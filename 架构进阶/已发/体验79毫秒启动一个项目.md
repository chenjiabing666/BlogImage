**大家好，我是不才陈某~**

先抛一个问题，大家在自己电脑上启动一个 spring boot 项目需要花费多久？

根据项目大小和机器环境，花费几秒到几十秒的人应该都有。

最近 spring 官方推出了一项技术可以将项目的启动时间缩短到 79 毫秒，79 毫秒大概是个什么概念？就是你还没反应过来项目已经启动好了，太牛了。

这项技术被 spring 官方命名为`Spring Native`，翻译成中文叫`Spring 云原生`，应该有少部分人听说过这个概念，我先带大家入门扫盲。

## Spring Native是什么？

`Spring Native` 是 Spring 推出微服务体系 Spring Cloud 之后的又一大举动，从名字可以猜出，Spring Native是一门面向云原生的技术。如果你还对这个概念不太理解，可以多看一点东西，比如 Oracle 的 GraalVM等。

Spring Native  为使用 GraalVM 原生镜像编译器编译 Spring 应用为本地可执行文件提供支持。与 Java 虚拟机相比，原生镜像可以在许多场景下降低工作负载，包括微服务，函数式服务，非常适合容器和 Kubernetes。使用原生镜像有明显优势，如快速启动，提高峰值性能以及降低内存消耗。

## Spring Native有多强？

上面提到了`原生镜像`，简单来说原生镜像是一种**将Java代码提前编译为独立可执行文件（称为本机映像）的技术**。可执行文件包括应用程序类，以及其依赖项的类，运行时库类以及JDK中的静态链接本机代码。

> 小芝士，GraalVM官网对原生镜像的解释：
>
> 原生镜像提供了一种构建和运行具有不同于常规JVM部署特性的Spring Boot应用程序的方法：
>
> - 输出是一个本机可执行文件，其中包含您的应用程序以及JDK的子集以及运行它所需的依赖项。
> - 在实践中，可执行文件可能会以高度优化的容器映像（`FROM scratch`支持Docker镜像）的形式提供，并且减少了表面攻击，非常适合Kubernetes。
> - 启动时间几乎是即时的，并且可以立即获得峰值性能，从而支持从零缩放（无服务器）应用程序，包括常规的Spring Boot Web应用程序。
> - 减少了内存消耗，这非常适合拆分为多个微服务的系统。

这些原生的 Spring 应用可以作为一个独立的可执行文件（原生镜像）进行部署（不需要安装 JVM），性能非常强：

- 几乎瞬时的启动（一般会小于 100 毫秒）
- 瞬时的峰值性能以及更低的资源消耗

当然牛逼的背后肯定要稍微付出一点代价：比 JVM 更长的构建时间和更少的运行时优化。

## 上手

既然 Spring Native 性能这么强悍，是不是得动手试一试了。

下面我会拿传统的 springboot 项目和基于 Spring Native的项目进行比较演示。

### 环境信息

- 电脑：MacBook pro 13寸 2017
- 操作系统：macOS Big Sur 11.2
- IDE：IntelliJ IDEA 2021.2.2 (Ultimate Edition)
- Open JDK：11.0.12
- maven：3.6.3
- Docker desktop：4.0.1

### 初始化项目

进入 spring 初始化页面：

https://start.spring.io/

**第一步：填写必要项目信息**

这里我选择 maven 构建，spring boot 版本选择 2.5.8，jdk 版本选择 11

![](https://www.java-family.cn/BlogImage/20220929204052.png)

**第二步：添加必要依赖**

添加两个依赖：

- spring native
- spring web

![](https://www.java-family.cn/BlogImage/20220929204056.png)

![](https://www.java-family.cn/BlogImage/20220929204201.png)

第三步：**生成项目骨架代码**

点击下载可以获得一个压缩包

![](https://mmbiz.qpic.cn/mmbiz_png/RXvHpViaz3EqGgxqe5rpSkQwS4YnxAbf1QScJolT3iaibpj5rbCpOKpbLgnia5OhcHvVhCiakSIenjQS5jPjTBickkfQ/640?wx_fmt=png)

> 注意：以上步骤也可以直接在 IDEA 里通过 start.spring.io进行新建，这里不再赘述。

### 运行项目

导入测试项目后可以在根目录下面看到一个帮助文档：

![](https://www.java-family.cn/BlogImage/20220929204107.png)

通过阅读帮助文档得知有两种方式启动 spring native 项目：

- 第一种：借助 maven 插件将项目构建为 docker 镜像，然后启动镜像；
- 第二种：借助本地构建工具将项目打包为一个可执行的文件，然后直接启动即可。

我电脑上已经装了 docker 工具，这里我演示一下第一种方式。

**第一步：生成docker 镜像文件**

```shell
$ ./mvnw spring-boot:build-image
```

这个过程可能有点漫长，也可能会失败，大家做好心理准备。

**第二步：启动镜像文件**

```shell
$ docker run --rm spring-native-demo:0.0.1-SNAPSHOT
```

执行完命令之后，项目瞬间就跑起来了。

### 性能测试对比

**场景一：使用 Spring Native**

官方宣称 79 毫秒就可以启动，原谅我的电脑太渣了，最好的一次花费了 143 毫秒，也就是一瞬间的事情，确实牛叉。

![](https://www.java-family.cn/BlogImage/20220929204112.png)



**场景二：普通启动**

没有对比就没有伤害，普通启动花费了2.091 秒

![](https://www.java-family.cn/BlogImage/20220929204115.png)



### 结论

在我的破电脑上测试，Spring Native 的启动速度大致是普通启动的 15 倍。

Spring Native 牛逼！牛逼！牛逼！（破音）

**FAQ**

在测试过程中踩了不少坑，这里做一个汇总。

**问题一：maven 依赖下载失败，网络差**

可以配置 maven 镜像仓库

```xml
<mirror>
  <id>aliyunmaven</id>
  <mirrorOf>*</mirrorOf>
  <name>central</name>
  <url>https://maven.aliyun.com/repository/central</url>
</mirror>
```

**问题二：镜像构建失败，提示内存不足**

![](https://www.java-family.cn/BlogImage/20220929204119.png)

解决方法：增大 Docker 的内存配置

![](https://www.java-family.cn/BlogImage/20220929204123.png)

## 最后说一句（别白嫖，求关注）

陈某每一篇文章都是精心输出，已经写了**3个专栏**，整理成**PDF**，获取方式如下：

1. [《Spring Cloud 进阶》](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MDAzNDg1MA==&action=getalbum&album_id=2042874937312346114#wechat_redirect)PDF：关注公众号：【**码猿技术专栏**】回复关键词 **Spring Cloud 进阶** 获取！
2. [《Spring Boot 进阶》](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MDAzNDg1MA==&action=getalbum&album_id=1532834475389288449#wechat_redirect)PDF：关注公众号：【**码猿技术专栏**】回复关键词 **Spring Boot进阶** 获取！
3. [《Mybatis 进阶》](https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzU3MDAzNDg1MA==&action=getalbum&album_id=1500819225232343046#wechat_redirect)PDF：关注公众号：【**码猿技术专栏**】回复关键词 **Mybatis 进阶** 获取！

如果这篇文章对你有所帮助，或者有所启发的话，帮忙**点赞**、**在看**、**转发**、**收藏**，你的支持就是我坚持下去的最大动力！