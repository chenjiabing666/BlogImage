**å¤§å®¶å¥½ï¼Œæˆ‘æ˜¯ä¸æ‰é™ˆæŸ~**

è´£ä»»é“¾æ¨¡å¼ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå°±æ˜¯å°†å¤šä¸ªæ“ä½œç»„è£…æˆä¸€æ¡é“¾è·¯è¿›è¡Œå¤„ç†ã€‚è¯·æ±‚åœ¨é“¾è·¯ä¸Šä¼ é€’ï¼Œé“¾è·¯ä¸Šçš„æ¯ä¸€ä¸ªèŠ‚ç‚¹å°±æ˜¯ä¸€ä¸ªå¤„ç†å™¨ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½å¯ä»¥å¯¹è¯·æ±‚è¿›è¡Œå¤„ç†ï¼Œæˆ–è€…ä¼ é€’ç»™é“¾è·¯ä¸Šçš„ä¸‹ä¸€ä¸ªå¤„ç†å™¨å¤„ç†ã€‚

![](https://www.java-family.cn/BlogImage/20221225193604.png)

## åº”ç”¨åœºæ™¯

è´£ä»»é“¾æ¨¡å¼çš„åº”ç”¨åœºæ™¯ï¼Œåœ¨å®é™…å·¥ä½œä¸­ï¼Œé€šå¸¸æœ‰å¦‚ä¸‹ä¸¤ç§åº”ç”¨åœºæ™¯ã€‚

- æ“ä½œéœ€è¦ç»è¿‡ä¸€ç³»åˆ—çš„æ ¡éªŒï¼Œé€šè¿‡æ ¡éªŒåæ‰æ‰§è¡ŒæŸäº›æ“ä½œã€‚
- å·¥ä½œæµã€‚ä¼ä¸šä¸­é€šå¸¸ä¼šåˆ¶å®šå¾ˆå¤šå·¥ä½œæµç¨‹ï¼Œä¸€çº§ä¸€çº§çš„å»å¤„ç†ä»»åŠ¡ã€‚

ä¸‹é¢é€šè¿‡ä¸¤ä¸ªæ¡ˆä¾‹æ¥å­¦ä¹ ä¸€ä¸‹è´£ä»»é“¾æ¨¡å¼ã€‚

## æ¡ˆä¾‹ä¸€ï¼šåˆ›å»ºå•†å“å¤šçº§æ ¡éªŒåœºæ™¯

ä»¥åˆ›å»ºå•†å“ä¸ºä¾‹ï¼Œå‡è®¾å•†å“åˆ›å»ºé€»è¾‘åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥å®Œæˆï¼šâ‘ åˆ›å»ºå•†å“ã€â‘¡æ ¡éªŒå•†å“å‚æ•°ã€â‘¢ä¿å­˜å•†å“ã€‚

ç¬¬â‘¡æ­¥æ ¡éªŒå•†å“åˆåˆ†ä¸ºå¤šç§æƒ…å†µçš„æ ¡éªŒï¼Œå¿…å¡«å­—æ®µæ ¡éªŒã€è§„æ ¼æ ¡éªŒã€ä»·æ ¼æ ¡éªŒã€åº“å­˜æ ¡éªŒç­‰ç­‰ã€‚è¿™äº›æ£€éªŒé€»è¾‘åƒä¸€ä¸ªæµæ°´çº¿ï¼Œè¦æƒ³åˆ›å»ºå‡ºä¸€ä¸ªå•†å“ï¼Œå¿…é¡»é€šè¿‡è¿™äº›æ ¡éªŒã€‚å¦‚ä¸‹æµç¨‹å›¾æ‰€ç¤ºï¼š

![](https://www.java-family.cn/BlogImage/20221225193612.png)

**ä¼ªä»£ç å¦‚ä¸‹ï¼š**

åˆ›å»ºå•†å“æ­¥éª¤ï¼Œéœ€è¦ç»è¿‡ä¸€ç³»åˆ—çš„å‚æ•°æ ¡éªŒï¼Œå¦‚æœå‚æ•°æ ¡éªŒå¤±è´¥ï¼Œç›´æ¥è¿”å›å¤±è´¥çš„ç»“æœï¼›é€šè¿‡æ‰€æœ‰çš„å‚æ•°æ ¡éªŒåï¼Œæœ€ç»ˆä¿å­˜å•†å“ä¿¡æ¯ã€‚

![](https://www.java-family.cn/BlogImage/20221225193621.png)

å¦‚ä¸Šä»£ç çœ‹èµ·æ¥ä¼¼ä¹æ²¡ä»€ä¹ˆé—®é¢˜ï¼Œå®ƒéå¸¸å·¥æ•´ï¼Œè€Œä¸”ä»£ç é€»è¾‘å¾ˆæ¸…æ™°ã€‚

> PSï¼šæˆ‘æ²¡æœ‰æŠŠæ‰€æœ‰çš„æ ¡éªŒä»£ç éƒ½ç½—åˆ—åœ¨ä¸€ä¸ªæ–¹æ³•é‡Œï¼Œé‚£æ ·æ›´èƒ½äº§ç”Ÿå¯¹æ¯”æ€§ï¼Œä½†æˆ‘è§‰å¾—æŠ½è±¡å¹¶åˆ†ç¦»å•ä¸€èŒè´£çš„å‡½æ•°åº”è¯¥æ˜¯æ¯ä¸ªç¨‹åºå‘˜æœ€åŸºæœ¬çš„è§„èŒƒï¼

ä½†æ˜¯éšç€ä¸šåŠ¡éœ€æ±‚ä¸æ–­åœ°å åŠ ï¼Œç›¸å…³çš„æ ¡éªŒé€»è¾‘ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œæ–°çš„åŠŸèƒ½ä½¿ä»£ç è¶Šæ¥è¶Šè‡ƒè‚¿ï¼Œå¯ç»´æŠ¤æ€§è¾ƒå·®ã€‚æ›´ç³Ÿç³•çš„æ˜¯ï¼Œè¿™äº›æ ¡éªŒç»„ä»¶ä¸å¯å¤ç”¨ï¼Œå½“ä½ æœ‰å…¶ä»–éœ€æ±‚ä¹Ÿéœ€è¦ç”¨åˆ°ä¸€äº›æ ¡éªŒæ—¶ï¼Œä½ åˆå˜æˆäº†Ctrlï¼‹C , Ctrlï¼‹Vç¨‹åºå‘˜ï¼Œç³»ç»Ÿçš„ç»´æŠ¤æˆæœ¬ä¹Ÿè¶Šæ¥è¶Šé«˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![](https://www.java-family.cn/BlogImage/20221225193638.png)

ä¼ªä»£ç åŒä¸Šï¼Œè¿™é‡Œå°±ä¸èµ˜è¿°äº†ã€‚

ç»ˆäºæœ‰ä¸€å¤©ï¼Œä½ å¿æ— å¯å¿äº†ï¼Œå†³å®šé‡æ„è¿™æ®µä»£ç ã€‚

**ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼ä¼˜åŒ–**ï¼šåˆ›å»ºå•†å“çš„æ¯ä¸ªæ ¡éªŒæ­¥éª¤éƒ½å¯ä»¥ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å¤„ç†å™¨ï¼ŒæŠ½ç¦»ä¸ºä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œä¾¿äºå¤ç”¨ã€‚è¿™äº›å¤„ç†å™¨å½¢æˆä¸€æ¡é“¾å¼è°ƒç”¨ï¼Œè¯·æ±‚åœ¨å¤„ç†å™¨é“¾ä¸Šä¼ é€’ï¼Œå¦‚æœæ ¡éªŒæ¡ä»¶ä¸é€šè¿‡ï¼Œåˆ™å¤„ç†å™¨ä¸å†å‘ä¸‹ä¼ é€’è¯·æ±‚ï¼Œç›´æ¥è¿”å›é”™è¯¯ä¿¡æ¯ï¼›è‹¥æ‰€æœ‰çš„å¤„ç†å™¨éƒ½é€šè¿‡æ£€éªŒï¼Œåˆ™æ‰§è¡Œä¿å­˜å•†å“æ­¥éª¤ã€‚

![](https://www.java-family.cn/BlogImage/20221225193647.png)

**æ¡ˆä¾‹ä¸€å®æˆ˜ï¼šè´£ä»»é“¾æ¨¡å¼å®ç°åˆ›å»ºå•†å“æ ¡éªŒ**

**UMLå›¾ï¼šä¸€è§ˆä¼—å±±å°**

![](https://www.java-family.cn/BlogImage/20221225193655.png)

**AbstractCheckHandler**è¡¨ç¤ºå¤„ç†å™¨æŠ½è±¡ç±»ï¼Œè´Ÿè´£æŠ½è±¡å¤„ç†å™¨è¡Œä¸ºã€‚å…¶æœ‰3ä¸ªå­ç±»ï¼Œåˆ†åˆ«æ˜¯ï¼š

- NullValueCheckHandlerï¼šç©ºå€¼æ ¡éªŒå¤„ç†å™¨
- PriceCheckHandlerï¼šä»·æ ¼æ ¡éªŒå¤„ç†
- StockCheckHandlerï¼šåº“å­˜æ ¡éªŒå¤„ç†å™¨

AbstractCheckHandler æŠ½è±¡ç±»ä¸­ï¼Œ `handle()`å®šä¹‰äº†å¤„ç†å™¨çš„æŠ½è±¡æ–¹æ³•ï¼Œå…¶å­ç±»éœ€è¦é‡å†™`handle()`æ–¹æ³•ä»¥å®ç°ç‰¹æ®Šçš„å¤„ç†å™¨æ ¡éªŒé€»è¾‘ï¼›

protected ProductCheckHandlerConfig config æ˜¯å¤„ç†å™¨çš„åŠ¨æ€é…ç½®ç±»ï¼Œä½¿ç”¨protectedå£°æ˜ï¼Œæ¯ä¸ªå­ç±»å¤„ç†å™¨éƒ½æŒæœ‰è¯¥å¯¹è±¡ã€‚è¯¥å¯¹è±¡ç”¨äºå£°æ˜å½“å‰å¤„ç†å™¨ã€ä»¥åŠå½“å‰å¤„ç†å™¨çš„ä¸‹ä¸€ä¸ªå¤„ç†å™¨nextHandlerï¼Œå¦å¤–ä¹Ÿå¯ä»¥é…ç½®ä¸€äº›ç‰¹æ®Šå±æ€§ï¼Œæ¯”å¦‚è¯´æ¥å£é™çº§é…ç½®ã€è¶…æ—¶æ—¶é—´é…ç½®ç­‰ã€‚

AbstractCheckHandler nextHandler æ˜¯å½“å‰å¤„ç†å™¨æŒæœ‰çš„ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨ï¼Œå½“å‰å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•æ—¶ï¼Œä¾¿è°ƒç”¨nextHandleræ‰§è¡Œä¸‹ä¸€å¤„ç†å™¨çš„handle()æ ¡éªŒæ–¹æ³•ï¼›

`protected Result next()` æ˜¯æŠ½è±¡ç±»ä¸­å®šä¹‰çš„ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„æ–¹æ³•ï¼Œä½¿ç”¨protectedå£°æ˜ï¼Œæ¯ä¸ªå­ç±»å¤„ç†å™¨éƒ½æŒæœ‰è¯¥å¯¹è±¡ã€‚å½“å­ç±»å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•(é€šè¿‡)æ—¶ï¼Œè°ƒç”¨çˆ¶ç±»çš„æ–¹æ³•æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨nextHandlerã€‚

HandlerClient æ˜¯æ‰§è¡Œå¤„ç†å™¨é“¾è·¯çš„å®¢æˆ·ç«¯ï¼Œ`HandlerClient.executeChain()`æ–¹æ³•è´Ÿè´£å‘èµ·æ•´ä¸ªé“¾è·¯è°ƒç”¨ï¼Œå¹¶æ¥æ”¶å¤„ç†å™¨é“¾è·¯çš„è¿”å›å€¼ã€‚

æ’¸èµ·è¢–å­å¼€å§‹æ’¸ä»£ç å§ ğŸ¤“ ~

**å•†å“å‚æ•°å¯¹è±¡ï¼šä¿å­˜å•†å“çš„å…¥å‚**

ProductVOæ˜¯åˆ›å»ºå•†å“çš„å‚æ•°å¯¹è±¡ï¼ŒåŒ…å«å•†å“çš„åŸºç¡€ä¿¡æ¯ã€‚å¹¶ä¸”å…¶ä½œä¸ºè´£ä»»é“¾æ¨¡å¼ä¸­å¤šä¸ªå¤„ç†å™¨çš„å…¥å‚ï¼Œå¤šä¸ªå¤„ç†å™¨éƒ½ä»¥ProductVOä¸ºå…¥å‚è¿›è¡Œç‰¹å®šçš„é€»è¾‘å¤„ç†ã€‚å®é™…ä¸šåŠ¡ä¸­ï¼Œå•†å“å¯¹è±¡ç‰¹åˆ«å¤æ‚ã€‚å’±ä»¬åŒ–ç¹ä¸ºç®€ï¼Œç®€åŒ–å•†å“å‚æ•°å¦‚ä¸‹ï¼š

```java
/**
 * å•†å“å¯¹è±¡
 */
@Data
@Builder
public class ProductVO {
    /**
     * å•†å“SKUï¼Œå”¯ä¸€
     */
    private Long skuId;
    /**
     * å•†å“åç§°
     */
    private String skuName;
    /**
     * å•†å“å›¾ç‰‡è·¯å¾„
     */
    private String Path;
    /**
     * ä»·æ ¼
     */
    private BigDecimal price;
    /**
     * åº“å­˜
     */
    private Integer stock;
}
```

**æŠ½è±¡ç±»å¤„ç†å™¨ï¼šæŠ½è±¡è¡Œä¸ºï¼Œå­ç±»å…±æœ‰å±æ€§ã€æ–¹æ³•**

**AbstractCheckHandler**ï¼šå¤„ç†å™¨æŠ½è±¡ç±»ï¼Œå¹¶ä½¿ç”¨@Componentæ³¨è§£æ³¨å†Œä¸ºç”±Springç®¡ç†çš„Beanå¯¹è±¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ¾çš„ä½¿ç”¨Springæ¥ç®¡ç†è¿™äº›å¤„ç†å™¨Beanã€‚

```java
/**
 * æŠ½è±¡ç±»å¤„ç†å™¨
 */
@Component
public abstract class AbstractCheckHandler {

    /**
     * å½“å‰å¤„ç†å™¨æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨
     */
    @Getter
    @Setter
    protected AbstractCheckHandler nextHandler;


    /**
     * å¤„ç†å™¨é…ç½®
     */
    @Setter
    @Getter
    protected ProductCheckHandlerConfig config;

    /**
     * å¤„ç†å™¨æ‰§è¡Œæ–¹æ³•
     * @param param
     * @return
     */
    public abstract Result handle(ProductVO param);

    /**
     * é“¾è·¯ä¼ é€’
     * @param param
     * @return
     */
    protected Result next(ProductVO param) {
        //ä¸‹ä¸€ä¸ªé“¾è·¯æ²¡æœ‰å¤„ç†å™¨äº†ï¼Œç›´æ¥è¿”å›
        if (Objects.isNull(nextHandler)) {
            return Result.success();
        }

        //æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨
        return nextHandler.handle(param);
    }

}
```

åœ¨AbstractCheckHandleræŠ½è±¡ç±»å¤„ç†å™¨ä¸­ï¼Œä½¿ç”¨protectedå£°æ˜å­ç±»å¯è§çš„å±æ€§å’Œæ–¹æ³•ã€‚ä½¿ç”¨ @Componentæ³¨è§£ï¼Œå£°æ˜å…¶ä¸ºSpringçš„Beanå¯¹è±¡ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥åˆ©ç”¨Springè½»æ¾ç®¡ç†æ‰€æœ‰çš„å­ç±»ï¼Œä¸‹é¢ä¼šçœ‹åˆ°å¦‚ä½•ä½¿ç”¨ã€‚æŠ½è±¡ç±»çš„å±æ€§å’Œæ–¹æ³•è¯´æ˜å¦‚ä¸‹ï¼š

- public abstract Result handle()ï¼šè¡¨ç¤ºæŠ½è±¡çš„æ ¡éªŒæ–¹æ³•ï¼Œæ¯ä¸ªå¤„ç†å™¨éƒ½åº”è¯¥ç»§æ‰¿AbstractCheckHandleræŠ½è±¡ç±»å¤„ç†å™¨ï¼Œå¹¶é‡å†™å…¶handleæ–¹æ³•ï¼Œå„ä¸ªå¤„ç†å™¨ä»è€Œå®ç°ç‰¹æ®Šçš„æ ¡éªŒé€»è¾‘ï¼Œå®é™…ä¸Šå°±æ˜¯å¤šæ€çš„æ€æƒ³ã€‚
- protected ProductCheckHandlerConfig configï¼šè¡¨ç¤ºæ¯ä¸ªå¤„ç†å™¨çš„åŠ¨æ€é…ç½®ç±»ï¼Œå¯ä»¥é€šè¿‡â€œé…ç½®ä¸­å¿ƒâ€åŠ¨æ€ä¿®æ”¹è¯¥é…ç½®ï¼Œå®ç°å¤„ç†å™¨çš„â€œåŠ¨æ€ç¼–æ’â€å’Œâ€œé¡ºåºæ§åˆ¶â€ã€‚é…ç½®ç±»ä¸­å¯ä»¥é…ç½®å¤„ç†å™¨çš„åç§°ã€ä¸‹ä¸€ä¸ªå¤„ç†å™¨ã€ä»¥åŠå¤„ç†å™¨æ˜¯å¦é™çº§ç­‰å±æ€§ã€‚
- protected AbstractCheckHandler nextHandlerï¼šè¡¨ç¤ºå½“å‰å¤„ç†å™¨æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†å™¨çš„å¼•ç”¨ï¼Œå¦‚æœå½“å‰å¤„ç†å™¨handle()æ ¡éªŒæ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œåˆ™æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨nextHandlerçš„handle()æ ¡éªŒæ–¹æ³•æ‰§è¡Œæ ¡éªŒé€»è¾‘ã€‚
- protected Result next(ProductVO param)ï¼šæ­¤æ–¹æ³•ç”¨äºå¤„ç†å™¨é“¾è·¯ä¼ é€’ï¼Œå­ç±»å¤„ç†å™¨æ‰§è¡Œå®Œæ¯•åï¼Œè°ƒç”¨çˆ¶ç±»çš„next()æ–¹æ³•æ‰§è¡Œåœ¨config é…ç½®çš„é“¾è·¯ä¸Šçš„ä¸‹ä¸€ä¸ªå¤„ç†å™¨ï¼Œå¦‚æœæ‰€æœ‰å¤„ç†å™¨éƒ½æ‰§è¡Œå®Œæ¯•äº†ï¼Œå°±è¿”å›ç»“æœäº†ã€‚

ProductCheckHandlerConfigé…ç½®ç±» :

```java
/**
 * å¤„ç†å™¨é…ç½®ç±»
 */
@AllArgsConstructor
@Data
public class ProductCheckHandlerConfig {
    /**
     * å¤„ç†å™¨Beanåç§°
     */
    private String handler;
    /**
     * ä¸‹ä¸€ä¸ªå¤„ç†å™¨
     */
    private ProductCheckHandlerConfig next;
    /**
     * æ˜¯å¦é™çº§
     */
    private Boolean down = Boolean.FALSE;
}
```

**å­ç±»å¤„ç†å™¨ï¼šå¤„ç†ç‰¹æœ‰çš„æ ¡éªŒé€»è¾‘**

AbstractCheckHandleræŠ½è±¡ç±»å¤„ç†å™¨æœ‰3ä¸ªå­ç±»åˆ†åˆ«æ˜¯ï¼š

- NullValueCheckHandlerï¼šç©ºå€¼æ ¡éªŒå¤„ç†å™¨
- PriceCheckHandlerï¼šä»·æ ¼æ ¡éªŒå¤„ç†
- StockCheckHandlerï¼šåº“å­˜æ ¡éªŒå¤„ç†å™¨

å„ä¸ªå¤„ç†å™¨ç»§æ‰¿AbstractCheckHandleræŠ½è±¡ç±»å¤„ç†å™¨ï¼Œå¹¶é‡å†™å…¶handle()å¤„ç†æ–¹æ³•ä»¥å®ç°ç‰¹æœ‰çš„æ ¡éªŒé€»è¾‘ã€‚

**NullValueCheckHandler**ï¼šç©ºå€¼æ ¡éªŒå¤„ç†å™¨ã€‚é’ˆå¯¹æ€§æ ¡éªŒåˆ›å»ºå•†å“ä¸­å¿…å¡«çš„å‚æ•°ã€‚å¦‚æœæ ¡éªŒæœªé€šè¿‡ï¼Œåˆ™è¿”å›é”™è¯¯ç ErrorCodeï¼Œè´£ä»»é“¾åœ¨æ­¤æˆªæ–­(åœæ­¢)ï¼Œåˆ›å»ºå•†å“è¿”å›è¢«æ ¡éªŒä½çš„é”™è¯¯ä¿¡æ¯ã€‚æ³¨æ„ä»£ç ä¸­çš„é™çº§é…ç½®ï¼

`super.getConfig().getDown()`æ˜¯è·å–AbstractCheckHandlerå¤„ç†å™¨å¯¹è±¡ä¸­ä¿å­˜çš„é…ç½®ä¿¡æ¯ï¼Œå¦‚æœå¤„ç†å™¨é…ç½®äº†é™çº§ï¼Œåˆ™è·³è¿‡è¯¥å¤„ç†å™¨ï¼Œè°ƒç”¨`super.next()`æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨é€»è¾‘ã€‚

åŒæ ·ï¼Œä½¿ç”¨@Componentæ³¨å†Œä¸ºç”±Springç®¡ç†çš„Beanå¯¹è±¡ï¼Œ

```java
/**
 * ç©ºå€¼æ ¡éªŒå¤„ç†å™¨
 */
@Component
public class NullValueCheckHandler extends AbstractCheckHandler{

    @Override
    public Result handle(ProductVO param) {
        System.out.println("ç©ºå€¼æ ¡éªŒ Handler å¼€å§‹...");
        
        //é™çº§ï¼šå¦‚æœé…ç½®äº†é™çº§ï¼Œåˆ™è·³è¿‡æ­¤å¤„ç†å™¨ï¼Œæ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨
        if (super.getConfig().getDown()) {
            System.out.println("ç©ºå€¼æ ¡éªŒ Handler å·²é™çº§ï¼Œè·³è¿‡ç©ºå€¼æ ¡éªŒ Handler...");
            return super.next(param);
        }
        
        //å‚æ•°å¿…å¡«æ ¡éªŒ
        if (Objects.isNull(param)) {
            return Result.failure(ErrorCode.PARAM_NULL_ERROR);
        }
        //SkuIdå•†å“ä¸»é”®å‚æ•°å¿…å¡«æ ¡éªŒ
        if (Objects.isNull(param.getSkuId())) {
            return Result.failure(ErrorCode.PARAM_SKU_NULL_ERROR);
        }
        //Priceä»·æ ¼å‚æ•°å¿…å¡«æ ¡éªŒ
        if (Objects.isNull(param.getPrice())) {
            return Result.failure(ErrorCode.PARAM_PRICE_NULL_ERROR);
        }
        //Stockåº“å­˜å‚æ•°å¿…å¡«æ ¡éªŒ
        if (Objects.isNull(param.getStock())) {
            return Result.failure(ErrorCode.PARAM_STOCK_NULL_ERROR);
        }
        
        System.out.println("ç©ºå€¼æ ¡éªŒ Handler é€šè¿‡...");
        
        //æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨
        return super.next(param);
    }
}
```

**PriceCheckHandler**ï¼šä»·æ ¼æ ¡éªŒå¤„ç†ã€‚é’ˆå¯¹åˆ›å»ºå•†å“çš„ä»·æ ¼å‚æ•°è¿›è¡Œæ ¡éªŒã€‚è¿™é‡Œåªæ˜¯åšäº†ç®€å•çš„åˆ¤æ–­ä»·æ ¼>0çš„æ ¡éªŒï¼Œå®é™…ä¸šåŠ¡ä¸­æ¯”è¾ƒå¤æ‚ï¼Œæ¯”å¦‚â€œä»·æ ¼é—¨â€è¿™äº›é˜²èŒƒæªæ–½ç­‰ã€‚

```java
/**
 * ä»·æ ¼æ ¡éªŒå¤„ç†å™¨
 */
@Component
public class PriceCheckHandler extends AbstractCheckHandler{
    @Override
    public Result handle(ProductVO param) {
        System.out.println("ä»·æ ¼æ ¡éªŒ Handler å¼€å§‹...");

        //éæ³•ä»·æ ¼æ ¡éªŒ
        boolean illegalPrice =  param.getPrice().compareTo(BigDecimal.ZERO) <= 0;
        if (illegalPrice) {
            return Result.failure(ErrorCode.PARAM_PRICE_ILLEGAL_ERROR);
        }
        //å…¶ä»–æ ¡éªŒé€»è¾‘...

        System.out.println("ä»·æ ¼æ ¡éªŒ Handler é€šè¿‡...");

        //æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨
        return super.next(param);
    }
}
```

**StockCheckHandler**ï¼šåº“å­˜æ ¡éªŒå¤„ç†å™¨ã€‚é’ˆå¯¹åˆ›å»ºå•†å“çš„åº“å­˜å‚æ•°è¿›è¡Œæ ¡éªŒã€‚

```java
/**
 * åº“å­˜æ ¡éªŒå¤„ç†å™¨
 */
@Component
public class StockCheckHandler extends AbstractCheckHandler{
    @Override
    public Result handle(ProductVO param) {
        System.out.println("åº“å­˜æ ¡éªŒ Handler å¼€å§‹...");

        //éæ³•åº“å­˜æ ¡éªŒ
        boolean illegalStock = param.getStock() < 0;
        if (illegalStock) {
            return Result.failure(ErrorCode.PARAM_STOCK_ILLEGAL_ERROR);
        }
        //å…¶ä»–æ ¡éªŒé€»è¾‘..

        System.out.println("åº“å­˜æ ¡éªŒ Handler é€šè¿‡...");

        //æ‰§è¡Œä¸‹ä¸€ä¸ªå¤„ç†å™¨
        return super.next(param);
    }
}
```

**å®¢æˆ·ç«¯ï¼šæ‰§è¡Œå¤„ç†å™¨é“¾è·¯**

HandlerClientå®¢æˆ·ç«¯ç±»è´Ÿè´£å‘èµ·æ•´ä¸ªå¤„ç†å™¨é“¾è·¯çš„æ‰§è¡Œï¼Œé€šè¿‡`executeChain()`æ–¹æ³•ã€‚å¦‚æœå¤„ç†å™¨é“¾è·¯è¿”å›é”™è¯¯ä¿¡æ¯ï¼Œå³æ ¡éªŒæœªé€šè¿‡ï¼Œåˆ™æ•´ä¸ªé“¾è·¯æˆªæ–­ï¼ˆåœæ­¢ï¼‰ï¼Œè¿”å›ç›¸åº”çš„é”™è¯¯ä¿¡æ¯ã€‚

```java
public class HandlerClient {

  public static Result executeChain(AbstractCheckHandler handler, ProductVO param) {
      //æ‰§è¡Œå¤„ç†å™¨
      Result handlerResult = handler.handle(param);
      if (!handlerResult.isSuccess()) {
          System.out.println("HandlerClient è´£ä»»é“¾æ‰§è¡Œå¤±è´¥è¿”å›ï¼š" + handlerResult.toString());
          return handlerResult;
      }
      return Result.success();
  }
}
```

ä»¥ä¸Šï¼Œè´£ä»»é“¾æ¨¡å¼ç›¸å…³çš„ç±»å·²ç»åˆ›å»ºå¥½äº†ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºå•†å“äº†ã€‚

**åˆ›å»ºå•†å“ï¼šæŠ½è±¡æ­¥éª¤ï¼ŒåŒ–ç¹ä¸ºç®€**

`createProduct()`åˆ›å»ºå•†å“æ–¹æ³•æŠ½è±¡ä¸º2ä¸ªæ­¥éª¤ï¼šâ‘ å‚æ•°æ ¡éªŒã€â‘¡åˆ›å»ºå•†å“ã€‚å‚æ•°æ ¡éªŒä½¿ç”¨è´£ä»»é“¾æ¨¡å¼è¿›è¡Œæ ¡éªŒï¼ŒåŒ…å«ï¼šç©ºå€¼æ ¡éªŒã€ä»·æ ¼æ ¡éªŒã€åº“å­˜æ ¡éªŒç­‰ç­‰ï¼Œåªæœ‰é“¾ä¸Šçš„æ‰€æœ‰å¤„ç†å™¨å‡æ ¡éªŒé€šè¿‡ï¼Œæ‰è°ƒç”¨`saveProduct()`åˆ›å»ºå•†å“æ–¹æ³•ï¼›å¦åˆ™è¿”å›æ ¡éªŒé”™è¯¯ä¿¡æ¯ã€‚

åœ¨`createProduct()`åˆ›å»ºå•†å“æ–¹æ³•ä¸­ï¼Œé€šè¿‡è´£ä»»é“¾æ¨¡å¼ï¼Œæˆ‘ä»¬å°†æ ¡éªŒé€»è¾‘è¿›è¡Œè§£è€¦ã€‚`createProduct()`åˆ›å»ºå•†å“æ–¹æ³•ä¸­ä¸éœ€è¦å…³æ³¨éƒ½è¦ç»è¿‡å“ªäº›æ ¡éªŒå¤„ç†å™¨ï¼Œä»¥åŠæ ¡éªŒå¤„ç†å™¨çš„ç»†èŠ‚ã€‚

```java
/**
 * åˆ›å»ºå•†å“
 * @return
 */
@Test
public Result createProduct(ProductVO param) {

    //å‚æ•°æ ¡éªŒï¼Œä½¿ç”¨è´£ä»»é“¾æ¨¡å¼
    Result paramCheckResult = this.paramCheck(param);
    if (!paramCheckResult.isSuccess()) {
        return paramCheckResult;
    }

    //åˆ›å»ºå•†å“
    return this.saveProduct(param);
}
```

**å‚æ•°æ ¡éªŒï¼šè´£ä»»é“¾æ¨¡å¼**

å‚æ•°æ ¡éªŒ`paramCheck()`æ–¹æ³•ä½¿ç”¨è´£ä»»é“¾æ¨¡å¼è¿›è¡Œå‚æ•°æ ¡éªŒï¼Œæ–¹æ³•å†…æ²¡æœ‰å£°æ˜å…·ä½“éƒ½æœ‰å“ªäº›æ ¡éªŒï¼Œå…·ä½“æœ‰å“ªäº›å‚æ•°æ ¡éªŒé€»è¾‘æ˜¯é€šè¿‡å¤šä¸ªå¤„ç†å™¨é“¾ä¼ é€’çš„ã€‚å¦‚ä¸‹ï¼š

```java
/**
 * å‚æ•°æ ¡éªŒï¼šè´£ä»»é“¾æ¨¡å¼
 * @param param
 * @return
 */
private Result paramCheck(ProductVO param) {

    //è·å–å¤„ç†å™¨é…ç½®ï¼šé€šå¸¸é…ç½®ä½¿ç”¨ç»Ÿä¸€é…ç½®ä¸­å¿ƒå­˜å‚¨ï¼Œæ”¯æŒåŠ¨æ€å˜æ›´
    ProductCheckHandlerConfig handlerConfig = this.getHandlerConfigFile();

    //è·å–å¤„ç†å™¨
    AbstractCheckHandler handler = this.getHandler(handlerConfig);

    //è´£ä»»é“¾ï¼šæ‰§è¡Œå¤„ç†å™¨é“¾è·¯
    Result executeChainResult = HandlerClient.executeChain(handler, param);
    if (!executeChainResult.isSuccess()) {
        System.out.println("åˆ›å»ºå•†å“ å¤±è´¥...");
        return executeChainResult;
    }

    //å¤„ç†å™¨é“¾è·¯å…¨éƒ¨æˆåŠŸ
    return Result.success();
}
```

`paramCheck()`æ–¹æ³•æ­¥éª¤è¯´æ˜å¦‚ä¸‹ï¼š

**ğŸ‘‰ æ­¥éª¤1ï¼šè·å–å¤„ç†å™¨é…ç½®ã€‚**

é€šè¿‡`getHandlerConfigFile()`æ–¹æ³•è·å–å¤„ç†å™¨é…ç½®ç±»å¯¹è±¡ï¼Œé…ç½®ç±»ä¿å­˜äº†é“¾ä¸Šå„ä¸ªå¤„ç†å™¨çš„ä¸Šä¸‹çº§èŠ‚ç‚¹é…ç½®ï¼Œæ”¯æŒæµç¨‹ç¼–æ’ã€åŠ¨æ€æ‰©å±•ã€‚é€šå¸¸é…ç½®æ˜¯é€šè¿‡Ducc(äº¬ä¸œè‡ªç ”çš„é…ç½®ä¸­å¿ƒ)ã€Nacos(é˜¿é‡Œå¼€æºçš„é…ç½®ä¸­å¿ƒ)ç­‰é…ç½®ä¸­å¿ƒå­˜å‚¨çš„ï¼Œæ”¯æŒåŠ¨æ€å˜æ›´ã€å®æ—¶ç”Ÿæ•ˆã€‚

åŸºäºæ­¤ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å®ç°æ ¡éªŒå¤„ç†å™¨çš„ç¼–æ’ã€ä»¥åŠåŠ¨æ€æ‰©å±•äº†ã€‚æˆ‘è¿™é‡Œæ²¡æœ‰ä½¿ç”¨é…ç½®ä¸­å¿ƒå­˜å‚¨å¤„ç†å™¨é“¾è·¯çš„é…ç½®ï¼Œè€Œæ˜¯ä½¿ç”¨JSONä¸²çš„å½¢å¼å»æ¨¡æ‹Ÿé…ç½®ï¼Œå¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥è‡ªè¡Œå®ç°ã€‚

```java
/**
 * è·å–å¤„ç†å™¨é…ç½®ï¼šé€šå¸¸é…ç½®ä½¿ç”¨ç»Ÿä¸€é…ç½®ä¸­å¿ƒå­˜å‚¨ï¼Œæ”¯æŒåŠ¨æ€å˜æ›´
 * @return
 */
private ProductCheckHandlerConfig getHandlerConfigFile() {
    //é…ç½®ä¸­å¿ƒå­˜å‚¨çš„é…ç½®
    String configJson = "{\"handler\":\"nullValueCheckHandler\",\"down\":true,\"next\":{\"handler\":\"priceCheckHandler\",\"next\":{\"handler\":\"stockCheckHandler\",\"next\":null}}}";
    //è½¬æˆConfigå¯¹è±¡
    ProductCheckHandlerConfig handlerConfig = JSON.parseObject(configJson, ProductCheckHandlerConfig.class);
    return handlerConfig;
}
```

ConfigJsonå­˜å‚¨çš„å¤„ç†å™¨é“¾è·¯é…ç½®JSONä¸²ï¼Œåœ¨ä»£ç ä¸­å¯èƒ½ä¸ä¾¿äºè§‚çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨json.cnç­‰æ ¼å¼åŒ–çœ‹ä¸€ä¸‹ï¼Œå¦‚ä¸‹ï¼Œé…ç½®çš„æ•´ä¸ªè°ƒç”¨é“¾è·¯è§„åˆ™ç‰¹åˆ«æ¸…æ™°ã€‚

![](https://www.java-family.cn/BlogImage/20221225193713.png)

`getHandlerConfigFile()`ç±»è·åˆ°é…ç½®ç±»çš„ç»“æ„å¦‚ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯æŠŠåœ¨é…ç½®ä¸­å¿ƒå‚¨å­˜çš„é…ç½®è§„åˆ™ï¼Œè½¬æ¢æˆé…ç½®ç±»`ProductCheckHandlerConfig`å¯¹è±¡ï¼Œç”¨äºç¨‹åºå¤„ç†ã€‚

> æ³¨æ„ï¼Œæ­¤æ—¶é…ç½®ç±»ä¸­å­˜å‚¨çš„ä»…ä»…æ˜¯å¤„ç†å™¨Spring Beançš„nameè€Œå·²ï¼Œå¹¶éå®é™…å¤„ç†å™¨å¯¹è±¡ã€‚

![](https://www.java-family.cn/BlogImage/20221225193751.png)

æ¥ä¸‹æ¥ï¼Œé€šè¿‡é…ç½®ç±»è·å–å®é™…è¦æ‰§è¡Œçš„å¤„ç†å™¨ã€‚

**ğŸ‘‰ æ­¥éª¤2ï¼šæ ¹æ®é…ç½®è·å–å¤„ç†å™¨ã€‚**

ä¸Šé¢æ­¥éª¤1é€šè¿‡`getHandlerConfigFile()`æ–¹æ³•è·å–åˆ°å¤„ç†å™¨é“¾è·¯é…ç½®è§„åˆ™åï¼Œå†è°ƒç”¨`getHandler()`è·å–å¤„ç†å™¨ã€‚

`getHandler()`å‚æ•°æ˜¯å¦‚ä¸ŠConfigJsoné…ç½®çš„è§„åˆ™ï¼Œå³æ­¥éª¤1è½¬æ¢æˆçš„`ProductCheckHandlerConfig`å¯¹è±¡ï¼›æ ¹æ®`ProductCheckHandlerConfig`é…ç½®è§„åˆ™è½¬æ¢æˆå¤„ç†å™¨é“¾è·¯å¯¹è±¡ã€‚ä»£ç å¦‚ä¸‹ï¼š

```java
![8](C:\Users\18796\Desktop\æ–‡ç« \8.png)![8](C:\Users\18796\Desktop\æ–‡ç« \8.png)![8](C:\Users\18796\Desktop\æ–‡ç« \8.png)/**
 * ä½¿ç”¨Springæ³¨å…¥:æ‰€æœ‰ç»§æ‰¿äº†AbstractCheckHandleræŠ½è±¡ç±»çš„Spring Beanéƒ½ä¼šæ³¨å…¥è¿›æ¥ã€‚Mapçš„Keyå¯¹åº”Beançš„name,Valueæ˜¯nameå¯¹åº”ç›¸åº”çš„Bean
 */
@Resource
private Map<String, AbstractCheckHandler> handlerMap;

/**
 * è·å–å¤„ç†å™¨
 * @param config
 * @return
 */
private AbstractCheckHandler getHandler (ProductCheckHandlerConfig config) {
    //é…ç½®æ£€æŸ¥ï¼šæ²¡æœ‰é…ç½®å¤„ç†å™¨é“¾è·¯ï¼Œåˆ™ä¸æ‰§è¡Œæ ¡éªŒé€»è¾‘
    if (Objects.isNull(config)) {
        return null;
    }
    //é…ç½®é”™è¯¯
    String handler = config.getHandler();
    if (StringUtils.isBlank(handler)) {
        return null;
    }
    //é…ç½®äº†ä¸å­˜åœ¨çš„å¤„ç†å™¨
    AbstractCheckHandler abstractCheckHandler = handlerMap.get(config.getHandler());
    if (Objects.isNull(abstractCheckHandler)) {
        return null;
    }
    
    //å¤„ç†å™¨è®¾ç½®é…ç½®Config
    abstractCheckHandler.setConfig(config);
    
    //é€’å½’è®¾ç½®é“¾è·¯å¤„ç†å™¨
    abstractCheckHandler.setNextHandler(this.getHandler(config.getNext()));

    return abstractCheckHandler;
}
```

**ğŸ‘‰ ğŸ‘‰ æ­¥éª¤2-1ï¼šé…ç½®æ£€æŸ¥ã€‚**

ä»£ç 14~27è¡Œï¼Œè¿›è¡Œäº†é…ç½®çš„ä¸€äº›æ£€æŸ¥æ“ä½œã€‚å¦‚æœé…ç½®é”™è¯¯ï¼Œåˆ™è·å–ä¸åˆ°å¯¹åº”çš„å¤„ç†å™¨ã€‚ä»£ç 23è¡Œ`handlerMap.get(config.getHandler())`æ˜¯ä»æ‰€æœ‰å¤„ç†å™¨æ˜ å°„Mapä¸­è·å–åˆ°å¯¹åº”çš„å¤„ç†å™¨Spring Beanã€‚

> æ³¨æ„ç¬¬5è¡Œä»£ç ï¼ŒhandlerMapå­˜å‚¨äº†æ‰€æœ‰çš„å¤„ç†å™¨æ˜ å°„ï¼Œæ˜¯é€šè¿‡Spring @Resourceæ³¨è§£æ³¨å…¥è¿›æ¥çš„ã€‚æ³¨å…¥çš„è§„åˆ™æ˜¯ï¼šæ‰€æœ‰ç»§æ‰¿äº†AbstractCheckHandleræŠ½è±¡ç±»ï¼ˆå®ƒæ˜¯Springç®¡ç†çš„Beanï¼‰çš„å­ç±»ï¼ˆå­ç±»ä¹Ÿæ˜¯Springç®¡ç†çš„Beanï¼‰éƒ½ä¼šæ³¨å…¥è¿›æ¥ã€‚

æ³¨å…¥è¿›æ¥çš„handlerMapä¸­ Mapçš„Keyå¯¹åº”Beançš„nameï¼ŒValueæ˜¯nameå¯¹åº”çš„Beanå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯å®é™…çš„å¤„ç†å™¨ï¼Œè¿™é‡ŒæŒ‡ç©ºå€¼æ ¡éªŒå¤„ç†å™¨ã€ä»·æ ¼æ ¡éªŒå¤„ç†å™¨ã€åº“å­˜æ ¡éªŒå¤„ç†å™¨ã€‚å¦‚ä¸‹ï¼š

![](https://www.java-family.cn/BlogImage/20221225193807.png)

è¿™æ ·æ ¹æ®é…ç½®ConfigJsonï¼ˆğŸ‘‰ æ­¥éª¤1ï¼šè·å–å¤„ç†å™¨é…ç½®ï¼‰ä¸­`handler:"priceCheckHandler"`çš„é…ç½®ï¼Œä½¿ç”¨`handlerMap.get(config.getHandler())`ä¾¿å¯ä»¥è·å–åˆ°å¯¹åº”çš„å¤„ç†å™¨Spring Beanå¯¹è±¡äº†ã€‚

**ğŸ‘‰ ğŸ‘‰ æ­¥éª¤2-2ï¼šä¿å­˜å¤„ç†å™¨è§„åˆ™ã€‚**

ä»£ç 29è¡Œï¼Œå°†é…ç½®è§„åˆ™ä¿å­˜åˆ°å¯¹åº”çš„å¤„ç†å™¨ä¸­`abstractCheckHandler.setConfig(config)`ï¼Œå­ç±»å¤„ç†å™¨å°±æŒæœ‰äº†é…ç½®çš„è§„åˆ™ã€‚

**ğŸ‘‰ ğŸ‘‰ æ­¥éª¤2-3ï¼šé€’å½’è®¾ç½®å¤„ç†å™¨é“¾è·¯ã€‚**

ä»£ç 32è¡Œï¼Œé€’å½’è®¾ç½®é“¾è·¯ä¸Šçš„å¤„ç†å™¨ã€‚

```java
//é€’å½’è®¾ç½®é“¾è·¯å¤„ç†å™¨ abstractCheckHandler.setNextHandler(this.getHandler(config.getNext()));
```

è¿™ä¸€æ­¥å¯èƒ½ä¸å¤ªå¥½ç†è§£ï¼Œç»“åˆConfigJsoné…ç½®çš„è§„åˆ™æ¥çœ‹ï¼Œä¼¼ä¹å°±å¾ˆå¾ˆå®¹æ˜“ç†è§£äº†ã€‚

![](https://www.java-family.cn/BlogImage/20221225193816.png)

ç”±ä¸Šè€Œä¸‹ï¼Œ`NullValueCheckHandler` ç©ºå€¼æ ¡éªŒå¤„ç†å™¨é€šè¿‡`setNextHandler()`æ–¹æ³•è®¾ç½®è‡ªå·±æŒæœ‰çš„ä¸‹ä¸€èŠ‚ç‚¹çš„å¤„ç†å™¨ï¼Œä¹Ÿå°±æ˜¯ä»·æ ¼å¤„ç†å™¨PriceCheckHandlerã€‚

æ¥ç€ï¼ŒPriceCheckHandlerä»·æ ¼å¤„ç†å™¨ï¼ŒåŒæ ·éœ€è¦ç»è¿‡æ­¥éª¤2-1é…ç½®æ£€æŸ¥ã€æ­¥éª¤2-2ä¿å­˜é…ç½®è§„åˆ™ï¼Œå¹¶ä¸”æœ€é‡è¦çš„æ˜¯ï¼Œå®ƒä¹Ÿéœ€è¦è®¾ç½®ä¸‹ä¸€èŠ‚ç‚¹çš„å¤„ç†å™¨StockCheckHandleråº“å­˜æ ¡éªŒå¤„ç†å™¨ã€‚

StockCheckHandleråº“å­˜æ ¡éªŒå¤„ç†å™¨ä¹Ÿä¸€æ ·ï¼ŒåŒæ ·éœ€è¦ç»è¿‡æ­¥éª¤2-1é…ç½®æ£€æŸ¥ã€æ­¥éª¤2-2ä¿å­˜é…ç½®è§„åˆ™ï¼Œä½†è¯·æ³¨æ„StockCheckHandlerçš„é…ç½®ï¼Œå®ƒçš„nextè§„åˆ™é…ç½®äº†nullï¼Œè¿™è¡¨ç¤ºå®ƒä¸‹é¢æ²¡æœ‰ä»»ä½•å¤„ç†å™¨è¦æ‰§è¡Œäº†ï¼Œå®ƒå°±æ˜¯æ•´ä¸ªé“¾è·¯ä¸Šçš„æœ€åä¸€ä¸ªå¤„ç†èŠ‚ç‚¹ã€‚

é€šè¿‡é€’å½’è°ƒç”¨`getHandler()`è·å–å¤„ç†å™¨æ–¹æ³•ï¼Œå°±**å°†æ•´ä¸ªå¤„ç†å™¨é“¾è·¯å¯¹è±¡ä¸²è”èµ·æ¥**äº†ã€‚å¦‚ä¸‹ï¼š

![](https://www.java-family.cn/BlogImage/20221225193826.png)

> å‹æƒ…æç¤ºï¼šé€’å½’è™½é¦™ï¼Œä½†ä½¿ç”¨é€’å½’ä¸€å®šè¦æ³¨æ„æˆªæ–­é€’å½’çš„æ¡ä»¶å¤„ç†ï¼Œå¦åˆ™å¯èƒ½é€ æˆæ­»å¾ªç¯å“¦ï¼

å®é™…ä¸Šï¼Œ`getHandler()`è·å–å¤„ç†å™¨å¯¹è±¡çš„ä»£ç å°±æ˜¯æŠŠåœ¨é…ç½®ä¸­å¿ƒé…ç½®çš„è§„åˆ™ConfigJsonï¼Œè½¬æ¢æˆé…ç½®ç±»`ProductCheckHandlerConfig`å¯¹è±¡ï¼Œå†æ ¹æ®é…ç½®ç±»å¯¹è±¡ï¼Œè½¬æ¢æˆå®é™…çš„å¤„ç†å™¨å¯¹è±¡ï¼Œè¿™ä¸ªå¤„ç†å™¨å¯¹è±¡æŒæœ‰æ•´ä¸ªé“¾è·¯çš„è°ƒç”¨é¡ºåºã€‚

**ğŸ‘‰ æ­¥éª¤3ï¼šå®¢æˆ·ç«¯æ‰§è¡Œè°ƒç”¨é“¾è·¯ã€‚**

```java
public class HandlerClient {

  public static Result executeChain(AbstractCheckHandler handler, ProductVO param) {
      //æ‰§è¡Œå¤„ç†å™¨
      Result handlerResult = handler.handle(param);
      if (!handlerResult.isSuccess()) {
          System.out.println("HandlerClient è´£ä»»é“¾æ‰§è¡Œå¤±è´¥è¿”å›ï¼š" + handlerResult.toString());
          return handlerResult;
      }
      return Result.success();
  }
}
```

getHandler()è·å–å®Œå¤„ç†å™¨åï¼Œæ•´ä¸ªè°ƒç”¨é“¾è·¯çš„æ‰§è¡Œé¡ºåºä¹Ÿå°±ç¡®å®šäº†ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¯¥å¹²æ´»äº†ï¼

`HandlerClient.executeChain(handler, param)`æ–¹æ³•æ˜¯HandlerClientå®¢æˆ·ç«¯ç±»æ‰§è¡Œå¤„ç†å™¨æ•´ä¸ªè°ƒç”¨é“¾è·¯çš„ï¼Œå¹¶æ¥æ”¶å¤„ç†å™¨é“¾è·¯çš„è¿”å›å€¼ã€‚

`executeChain()`é€šè¿‡`AbstractCheckHandler.handle()`è§¦å‘æ•´ä¸ªé“¾è·¯å¤„ç†å™¨é¡ºåºæ‰§è¡Œï¼Œå¦‚æœæŸä¸ªå¤„ç†å™¨æ ¡éªŒæ²¡æœ‰é€šè¿‡`!handlerResult.isSuccess()`ï¼Œåˆ™è¿”å›é”™è¯¯ä¿¡æ¯ï¼›æ‰€æœ‰å¤„ç†å™¨éƒ½æ ¡éªŒé€šè¿‡ï¼Œåˆ™è¿”å›æ­£ç¡®ä¿¡æ¯`Result.success()`ã€‚

**æ€»ç»“ï¼šä¸²è”æ–¹æ³•è°ƒç”¨æµç¨‹**

åŸºäºä»¥ä¸Šï¼Œå†é€šè¿‡æµç¨‹å›¾æ¥å›é¡¾ä¸€ä¸‹æ•´ä¸ªè°ƒç”¨æµç¨‹ã€‚

![](https://www.java-family.cn/BlogImage/20221225193833.png)

**æµ‹è¯•ï¼šä»£ç æ‰§è¡Œç»“æœ**

åœºæ™¯1ï¼šåˆ›å»ºå•†å“å‚æ•°ä¸­æœ‰ç©ºå€¼ï¼ˆå¦‚ä¸‹skuIdå‚æ•°ä¸ºnullï¼‰ï¼Œé“¾è·¯è¢«ç©ºå€¼å¤„ç†å™¨æˆªæ–­ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯

```java
//åˆ›å»ºå•†å“å‚æ•°
ProductVO param = ProductVO.builder()
      .skuId(null).skuName("åä¸ºæ‰‹æœº").Path("http://...")
      .price(new BigDecimal(1))
      .stock(1)
      .build();
```

æµ‹è¯•ç»“æœ

![](https://www.java-family.cn/BlogImage/20221225193843.png)

åœºæ™¯2ï¼šåˆ›å»ºå•†å“ä»·æ ¼å‚æ•°å¼‚å¸¸ï¼ˆå¦‚ä¸‹priceå‚æ•°ï¼‰ï¼Œè¢«ä»·æ ¼å¤„ç†å™¨æˆªæ–­ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯

```java
ProductVO param = ProductVO.builder()
      .skuId(1L).skuName("åä¸ºæ‰‹æœº").Path("http://...")
      .price(new BigDecimal(-999))
      .stock(1)
      .build();
```

æµ‹è¯•ç»“æœ

![](https://www.java-family.cn/BlogImage/20221225193851.png)

åœºæ™¯ 3ï¼šåˆ›å»ºå•†å“åº“å­˜å‚æ•°å¼‚å¸¸ï¼ˆå¦‚ä¸‹stockå‚æ•°ï¼‰ï¼Œè¢«åº“å­˜å¤„ç†å™¨æˆªæ–­ï¼Œè¿”å›é”™è¯¯ä¿¡æ¯ã€‚

```java
//åˆ›å»ºå•†å“å‚æ•°ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ä¼ å…¥
ProductVO param = ProductVO.builder()
      .skuId(1L).skuName("åä¸ºæ‰‹æœº").Path("http://...")
      .price(new BigDecimal(1))
      .stock(-999)
      .build();
```

æµ‹è¯•ç»“æœ

![](https://www.java-family.cn/BlogImage/20221225193939.png)

åœºæ™¯4ï¼šåˆ›å»ºå•†å“æ‰€æœ‰å¤„ç†å™¨æ ¡éªŒé€šè¿‡ï¼Œä¿å­˜å•†å“ã€‚

```java
![15](C:\Users\18796\Desktop\æ–‡ç« \15.png)![15](C:\Users\18796\Desktop\æ–‡ç« \15.png)![15](C:\Users\18796\Desktop\æ–‡ç« \15.png)![15](C:\Users\18796\Desktop\æ–‡ç« \15.png)//åˆ›å»ºå•†å“å‚æ•°ï¼Œæ¨¡æ‹Ÿç”¨æˆ·ä¼ å…¥
ProductVO param = ProductVO.builder()
      .skuId(1L).skuName("åä¸ºæ‰‹æœº").Path("http://...")
      .price(new BigDecimal(999))
      .stock(1).build();
```

æµ‹è¯•ç»“æœ

![](https://www.java-family.cn/BlogImage/20221225193947.png)

## æ¡ˆä¾‹äºŒï¼šå·¥ä½œæµï¼Œè´¹ç”¨æŠ¥é”€å®¡æ ¸æµç¨‹

åŒäº‹å°è´¾æœ€è¿‘åˆšå‡ºå·®å›æ¥ï¼Œå¥¹è¿«ä¸åŠå¾…çš„å°±æäº¤äº†è´¹ç”¨æŠ¥é”€çš„æµç¨‹ã€‚æ ¹æ®é‡‘é¢ä¸åŒï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ ç§å®¡æ ¸æµç¨‹ã€‚æŠ¥é”€é‡‘é¢ä½äº1000å…ƒï¼Œä¸‰çº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹å³å¯ï¼Œ1000åˆ°5000å…ƒé™¤äº†ä¸‰çº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹ï¼Œè¿˜éœ€è¦äºŒçº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹ï¼Œè€Œ5000åˆ°10000å…ƒè¿˜éœ€è¦ä¸€çº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹ã€‚å³æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š

1. å°è´¾éœ€æŠ¥é”€500å…ƒï¼Œä¸‰çº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹å³å¯ã€‚
2. å°è´¾éœ€æŠ¥é”€2500å…ƒï¼Œä¸‰çº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹é€šè¿‡åï¼Œè¿˜éœ€è¦äºŒçº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹ï¼ŒäºŒçº§éƒ¨é—¨ç®¡ç†è€…å®¡æ‰¹é€šè¿‡åï¼Œæ‰å®ŒæˆæŠ¥é”€å®¡æ‰¹æµç¨‹ã€‚
3. å°è´¾éœ€æŠ¥é”€7500å…ƒï¼Œä¸‰çº§ç®¡ç†è€…å®¡æ‰¹é€šè¿‡åï¼Œå¹¶ä¸”äºŒçº§ç®¡ç†è€…å®¡æ‰¹é€šè¿‡åï¼Œæµç¨‹æµè½¬åˆ°ä¸€çº§éƒ¨é—¨ç®¡ç†è€…è¿›è¡Œå®¡æ‰¹ï¼Œä¸€çº§ç®¡ç†è€…å®¡æ‰¹é€šè¿‡åï¼Œå³å®Œæˆäº†æŠ¥é”€æµç¨‹ã€‚

![](https://www.java-family.cn/BlogImage/20221225193958.png)

**UMLå›¾**

AbstractFlowHandlerä½œä¸ºå¤„ç†å™¨æŠ½è±¡ç±»ï¼ŒæŠ½è±¡äº†`approve()`å®¡æ ¸æ–¹æ³•ï¼Œä¸€çº§ã€äºŒçº§ã€ä¸‰çº§éƒ¨é—¨ç®¡ç†è€…å¤„ç†å™¨ç»§æ‰¿äº†æŠ½è±¡ç±»ï¼Œå¹¶é‡å†™å…¶`approve()`å®¡æ ¸æ–¹æ³•ï¼Œä»è€Œå®ç°ç‰¹æœ‰çš„å®¡æ ¸é€»è¾‘ã€‚

![](https://www.java-family.cn/BlogImage/20221225194006.png)

é…ç½®ç±»å¦‚ä¸‹æ‰€ç¤ºï¼Œæ¯å±‚çš„å¤„ç†å™¨éƒ½è¦é…ç½®å®¡æ ¸äººã€ä»·æ ¼å®¡æ ¸è§„åˆ™ï¼ˆå®¡æ ¸çš„æœ€å¤§ã€æœ€å°é‡‘é¢ï¼‰ã€ä¸‹ä¸€çº§å¤„ç†äººã€‚é…ç½®è§„åˆ™æ˜¯å¯ä»¥åŠ¨æ€å˜æ›´çš„ï¼Œå¦‚æœä¸‰çº§éƒ¨é—¨ç®¡ç†è€…å¯ä»¥å®¡æ ¸çš„é‡‘é¢å¢åŠ åˆ°2000å…ƒï¼Œä¿®æ”¹ä¸€ä¸‹é…ç½®å³å¯åŠ¨æ€ç”Ÿæ•ˆã€‚

![](https://www.java-family.cn/BlogImage/20221225194012.png)

ä»£ç å®ç°ä¸æ¡ˆä¾‹ä¸€ç›¸ä¼¼ï¼Œæ„Ÿå…´è¶£çš„è‡ªå·±åŠ¨åŠ¨å°æ‰‹å§~

## è´£ä»»é“¾çš„ä¼˜ç¼ºç‚¹

![](https://www.java-family.cn/BlogImage/20221225194019.png)

![](https://www.java-family.cn/BlogImage/20221225194026.png)

## æºç æŸ¥çœ‹

åœ°å€ï¼šhttps://github.com/rongtao7/MyNotes

